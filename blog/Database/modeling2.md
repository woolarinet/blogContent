---
title: '성능 데이터 모델링'
category: 'Database'
desc: '모델의 성능을 올리기위한 이론적 개념 (정규화, 반정규화)'
date: '2021-08-29'
thumb: 'database'
---

# 성능 데이터 모델링 고려사항
- 데이터 모델링을 할 때, 정규화를 정확히 수행한다.
  - 정규화된 모델이 데이터를 주요 관심사별로 분산시키는 효과가 있기에 그 자체로 성능을 향상시킬 수 있다.
- 데이터베이스 용량산정을 수행한다.
  - 엔터티별로 데이터가 대용량인지 구분하게 하기 때문에 테이블에 대한 성능고려를 엄격하게 적용해야 하는지 기준이 될 수 있다.
- 데이터 모델에 발생되는 트랜잭션의 유형을 파악한다.
  - CRUD 매트릭스나 객체지향 모델링을 적용한다면 시퀀스 다이어그램이 용이하다.
  - 또한 화면에서 처리된 데이터의 종류들을 보면 이벤트에 따라 테이블에 데이터가 어떻게 처리되는지 유추할 수 있다.
  - 트랜잭션의 유형을 파악하게 되면 SQL문의 조인관계 테이블에서 데이터조회의 칼럼들을 파악할 수 있게 되어 그에 따라 성능을 고려한 데이터 모델을 설계할 수 있다.
- 용량과 트랜잭션이 유형에 따라 반정규화를 수행한다.
  - 반정규화는 테이블, 속성, 관계에 대해 포괄적인 방법을 적용한다.
  - PK/FK의 순서가 인덱스 특성에 따라 성능에 미치는 영향이 크기에 반드시 PK/FK를 성능이 우수한 순서대로 칼럼의 순서를 조정한다.

## 정규화
- 정규화를 하는 것은 기본적으로 데이터에 대한 중복성을 제거하여 주고, 데이터가 관심사별로 처리되는 경우가 많기 때문에 성능이 향상되는 특징을 가지고 있다.
- 엔터티가 계속 발생되면서 조인이 많이 발생하여 성능저하가 나타나는 경우가 있지만, 이런 경우에는 반정규화를 적용하는 전략이 필요하다.
- 정규화를 수행하게 되면, 데이터의 중복속성을 제거하고 결정자에 의해 동일한 의미의 일반속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과가 있다.

### 정규화를 수행하면 항상 조회 성능이 저하될까?
- 데이터베이스에서 데이터를 처리할 때 **성능** 이라고 하면 조회 성능과 입력/수정/삭제 성능의 두 가지로 구분 된다.
- 이 두 가지가 모두 우수하면 좋겠지만 모델을 구성하는 방식에 따라 두 성능이 Trade-off 되는 경우가 종종 발생한다.

  - ![erd.png](https://raw.githubusercontent.com/woolarinet/blog_content/main/images/Database/modeling2/1.png)
    - 위 사진과 같이, 정규화 모델은 데이터를 입력/수정/삭제할 때 반정규화된 테이블에 비해 처리 성능이 향상된다. 단, 데이터를 조회할 때에는 처리 조건에 따라 조회 성능이 향상될 수도 있고 저하될 수도 있다.
    - ***그렇다고 무조건 반정규화만이 조회 성능을 향상 시키는 것이 아니다.***
    - 정규화 후 조인을 통해 생성된 테이블이 반정규화한 테이블과 비교하여 훨씬 더 적은 데이터를 갖고 있어 조회 성능이 향상되는 경우나, 각 속성에 맞는 인덱스를 적절히 분류하여 정규화를 진행하여 조회 성능을 높이는 경우도 존재한다.
## 반정규화
- 정규화를 수행하지 않은 모델을 지칭할 때 사용한다.
- 의도적으로 데이터를 중복하여 성능을 향상시키기 위한 기법이라고 정의할 수 있고 좀 더 넓은 의미의 반정규화는 정규화된 데이터 모델에서 중복, 통합, 분리 등을 수행하는 과정을 의미한다.
- 데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 데이터를 중복하여 데이터를 조회할 때 디스크 I/O량이 많거나 경로가 너무 멀어 조인으로 인한 성능저하가 예상되거나 칼럼을 계산하여 읽을 때 성능저하가 예상되는 경우 수행하게 된다.
- 반정규화를 적용할 때 반드시 데이터 무결성을 보장할 수 있는 방법을 고려한 후에 적용해야 한다.
  - 정규화와 반정규화는 서로 성능이 반비례하는 경우가 존재할 수 있기에 무결성이 충분히 유지될 수 있도록 프로세스 처리에 있어서 안정성이 먼저 확인이 되야 한다.

### 반정규화 절차

- ![erd.png](https://raw.githubusercontent.com/woolarinet/blog_content/main/images/Database/modeling2/2.png)
  1. 전체 데이터의 양을 조사하고 해당 프로세스를 처리할 때 성능저하가 나타날 수 있는지 검증한다.
    - 자주 사용되는 테이블에 접근하는 프로세스가 많고 항상 일정한 범위를 조회하는 경우
    - 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우
    - 통계 정보를 필요로 할 때 별도의 통계테이블(반정규화)을 생성한다.
    - 테이블에 지나치게 많은 조인이 걸려 조회하는 작업이 기술적으로 어려울 경우
  2. 반정규화 대상을 다른 방법으로 처리할 수 있는지 검토한다.
    - 조회 시에 지나치게 많은 조인이 걸리는 경우, VIEW(뷰)를 사용하는 경우를 고려한다. 뷰를 통해 접근하게 함으로 성능저하의 위험을 예방할 수 있다.
    - 대량의 데이터처리는 클러스터링을 적용하거나 인덱스를 조정함으로 성능을 향상시킬 수 있다.
    - 대량의 데이터는 PK의 성격에 따라 부분적인 테이블로 분리할 수 있다. (파티셔닝 기법)
    - 백엔드 로직을 변경하여 데이터를 처리하기 위한 값을 캐싱하는 등의 방법을 통해 데이터를 공유하게 하여 성능을 향상시킬 수도 있다.
  3. 반정규화를 적용한다.
    - 반정규화를 하는 대상으로는 테이블, 속성, 관계에 대해 적용할 수 있다.
### 반정규화 기법
- 테이블 반정규화

  - ![erd.png](https://raw.githubusercontent.com/woolarinet/blog_content/main/images/Database/modeling2/3.png)

- 칼럼 반정규화

  - ![erd.png](https://raw.githubusercontent.com/woolarinet/blog_content/main/images/Database/modeling2/4.png)

- 관계 반정규화

  - ![erd.png](https://raw.githubusercontent.com/woolarinet/blog_content/main/images/Database/modeling2/5.png)
    - 관계의 반정규화는 데이터 무결성을 깨트릴 위험을 갖지 않고서도 성능을 향상시킬 수 있는 기법이 될 수 있다.
    - 모델 전체가 관계로 연결되어 있고, 관계가 서로 먼 친척간에 조인관계가 빈번하게 발생한다면 관계의 반정규화를 통해 성능향상을 도모할 필요가 있다.

- **반정규화를 적용할 때 반드시 데이터를 입력, 수정, 삭제할 때에는 성능이 떨어질 수 있다는 점과 데이터 무결성의 유지, 두 가지를 기억하고 주의해야 한다.**

## Reference
- SQL 개발자 기본서
